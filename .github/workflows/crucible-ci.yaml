name: crucible-ci

on:
  # run on push or pull request events for the master branch only
  pull_request:
    branches: [ master ]

  # allow for manual invocation from the actions tab
  workflow_dispatch:

jobs:
  crucible-ci-samples-iteration-repeat-runs-fio:
    name: crucible-ci-samples-iteration-repeat-runs-fio
    runs-on: ubuntu-latest

    steps:
    - name: Checkout rickshaw
      uses: actions/checkout@v2
      with:
        path: rickshaw

    - name: Checkout crucible-ci
      uses: actions/checkout@v2
      with:
        repository: k-rister/crucible-ci
        ref: dev-kmr
        path: crucible-ci

    - name: Run crucible-ci->integration-tests
      uses: ./crucible-ci/.github/actions/integration-tests
      with:
        artifact_tag: "samples-iteration-repeat-runs"
        ci_target: "rickshaw"
        ci_target_dir: ${{ github.workspace }}/rickshaw
        scenarios: "fio"
        repeat_runs: "yes"
        run_samples: "3"

  crucible-ci-all-userenvs-fio:
    name: crucible-ci-fio
    runs-on: ubuntu-latest

    steps:
    - name: Checkout rickshaw
      uses: actions/checkout@v2
      with:
        path: rickshaw

    - name: Checkout crucible-ci
      uses: actions/checkout@v2
      with:
        repository: k-rister/crucible-ci
        ref: dev-kmr
        path: crucible-ci

    - name: Run crucible-ci->integration-tests
      uses: ./crucible-ci/.github/actions/integration-tests
      with:
        artifact_tag: "fio"
        ci_target: "rickshaw"
        ci_target_dir: ${{ github.workspace }}/rickshaw
        scenarios: "fio"
        userenvs: "all"

  crucible-ci-all-userenvs-uperf:
    name: crucible-ci-uperf
    runs-on: ubuntu-latest

    steps:
    - name: Checkout rickshaw
      uses: actions/checkout@v2
      with:
        path: rickshaw

    - name: Checkout crucible-ci
      uses: actions/checkout@v2
      with:
        repository: k-rister/crucible-ci
        ref: dev-kmr
        path: crucible-ci

    - name: Run crucible-ci->integration-tests
      uses: ./crucible-ci/.github/actions/integration-tests
      with:
        artifact_tag: "uperf"
        ci_target: "rickshaw"
        ci_target_dir: ${{ github.workspace }}/rickshaw
        scenarios: "uperf"
        userenvs: "all"
